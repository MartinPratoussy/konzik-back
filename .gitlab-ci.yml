default:
  image: docker:latest
  tags:
    - runner-l

stages:
  - build-common
  - compile
  - build-image
  - deploy

build-dependance:
  image: maven:3.8.5-openjdk-17
  stage: build-common
  script:
    - cd ./Common
    - mvn compile
  artifacts:
    name: common
    paths:
      - ./Common/
  when: manual

compile-auth:
  image: maven:3.8.5-openjdk-17
  stage: compile
  script:
    - cd ./Common
    - mvn install
    - cd ../Auth
    - mvn compile
    - mvn install -DskipTests
    - ls -l
    - mv ./target/*.jar ./target/auth.jar
  artifacts:
    name: auth
    paths:
      - ./target/auth.jar
  when: manual
